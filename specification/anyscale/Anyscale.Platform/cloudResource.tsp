import "@typespec/rest";
import "@typespec/http";
import "@azure-tools/typespec-azure-core";
import "@azure-tools/typespec-azure-resource-manager";
import "./cloud.tsp";

using Rest;
using Http;
using Azure.Core;
using Azure.ResourceManager;

namespace Anyscale.Platform;

@parentResource(Cloud)
@resource("cloudResources")
model CloudResource is TrackedResource<CloudResourceProperties> {
  @pattern("^[a-zA-Z0-9]*$")
  @key("cloudResourceName")
  @path
  @segment("cloudResources")
  name: string;
}

model CloudResourceProperties {
  // The cloud resource ID which is used during Anyscale operator bootstrap, generated by
  // Anyscale control plane.
  @visibility(Lifecycle.Read)
  cloudResourceId?: string;

  // Provider of the cloud resource.
  provider: Provider;

  // Compute stack of the cloud resource.
  computeStack: ComputeStack;

  // A fully qualified storage bucket name for cloud storage, e.g. s3://bucket-name,
  // gs://bucket-name, or abfss://bucket-name@account.dfs.core.windows.net.
  cloudStorageBucketName: string;

  cloudStorageBucketEndpoint: string;

  @visibility(Lifecycle.Read)
  provisioningState?: ProvisioningState;
}

// Cloud provider for the cloud resources.
enum Provider {
  Azure,
}

// Compute stack associated with the cloud resource.
enum ComputeStack {
  K8S,
}

@armResourceOperations
interface CloudResources {
  createOrUpdate is ArmResourceCreateOrReplaceAsync<CloudResource>;
  delete is ArmResourceDeleteWithoutOkAsync<CloudResource>;
  get is ArmResourceRead<CloudResource>;
  listByResourceGroup is ArmResourceListByParent<CloudResource>;
  listBySubscription is ArmListBySubscription<CloudResource>;
}
